<UserControl x:Class="UndertaleModTool.UndertaleSpriteEditor"
             xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
             xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
             xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006" 
             xmlns:d="http://schemas.microsoft.com/expression/blend/2008" 
             xmlns:local="clr-namespace:UndertaleModTool"
		     xmlns:undertale="clr-namespace:UndertaleModLib.Models;assembly=UndertaleModLib"
             mc:Ignorable="d" 
             d:DesignHeight="450" d:DesignWidth="800" d:DataContext="{d:DesignInstance undertale:UndertaleSprite}">
    
    <Grid>
        <Grid.ColumnDefinitions>
            <ColumnDefinition Width="1*"/>
            <ColumnDefinition Width="3*"/>
        </Grid.ColumnDefinitions>
        <Grid.RowDefinitions>
            <RowDefinition Height="Auto"/>
            <RowDefinition Height="Auto"/>
            <RowDefinition Height="Auto"/>
            <RowDefinition Height="Auto"/>
            <RowDefinition Height="Auto"/>
            <RowDefinition Height="Auto"/>
            <RowDefinition Height="Auto"/>
            <RowDefinition Height="Auto"/>
            <RowDefinition Height="Auto"/>
            <RowDefinition Height="Auto"/>
            <RowDefinition Height="Auto"/>
        </Grid.RowDefinitions>

        <TextBlock Grid.Row="0" Grid.Column="0" Margin="3">Name</TextBlock>
        <local:UndertaleStringReference Grid.Row="0" Grid.Column="1" Margin="3" ObjectReference="{Binding Name}"/>

        <TextBlock Grid.Row="2" Grid.Column="0" Margin="3">Size</TextBlock>
        <Grid Grid.Row="2" Grid.Column="1">
            <Grid.ColumnDefinitions>
                <ColumnDefinition Width="*"/>
                <ColumnDefinition Width="*"/>
            </Grid.ColumnDefinitions>
            <TextBox Grid.Column="0" Margin="3" Text="{Binding Width}"/>
            <TextBox Grid.Column="1" Margin="3" Text="{Binding Height}"/>
        </Grid>

        <TextBlock Grid.Row="3" Grid.Column="0" Margin="3">Marigin Left/Right/Bottom/Top</TextBlock>
        <Grid Grid.Row="3" Grid.Column="1">
            <Grid.ColumnDefinitions>
                <ColumnDefinition Width="*"/>
                <ColumnDefinition Width="*"/>
                <ColumnDefinition Width="*"/>
                <ColumnDefinition Width="*"/>
            </Grid.ColumnDefinitions>
            <TextBox Grid.Column="0" Margin="3" Text="{Binding MarginLeft}"/>
            <TextBox Grid.Column="1" Margin="3" Text="{Binding MarginRight}"/>
            <TextBox Grid.Column="2" Margin="3" Text="{Binding MarginBottom}"/>
            <TextBox Grid.Column="3" Margin="3" Text="{Binding MarginTop}"/>
        </Grid>

        <TextBlock Grid.Row="4" Grid.Column="0" Margin="3">Unknown</TextBlock>
        <Grid Grid.Row="4" Grid.Column="1">
            <Grid.ColumnDefinitions>
                <ColumnDefinition Width="*"/>
                <ColumnDefinition Width="*"/>
                <ColumnDefinition Width="*"/>
            </Grid.ColumnDefinitions>
            <TextBox Grid.Column="0" Margin="3" Text="{Binding Unknown1}"/>
            <TextBox Grid.Column="1" Margin="3" Text="{Binding Unknown2}"/>
            <TextBox Grid.Column="2" Margin="3" Text="{Binding Unknown3}"/>
        </Grid>

        <TextBlock Grid.Row="5" Grid.Column="0" Margin="3">Bounding box mode</TextBlock>
        <TextBox Grid.Row="5" Grid.Column="1" Margin="3" Text="{Binding BBoxMode}"/>

        <TextBlock Grid.Row="6" Grid.Column="0" Margin="3">SepMasks (?)</TextBlock>
        <TextBox Grid.Row="6" Grid.Column="1" Margin="3" Text="{Binding SepMasks}"/>

        <TextBlock Grid.Row="7" Grid.Column="0" Margin="3">Origin</TextBlock>
        <Grid Grid.Row="7" Grid.Column="1">
            <Grid.ColumnDefinitions>
                <ColumnDefinition Width="*"/>
                <ColumnDefinition Width="*"/>
            </Grid.ColumnDefinitions>
            <TextBox Grid.Column="0" Margin="3" Text="{Binding OriginX}"/>
            <TextBox Grid.Column="1" Margin="3" Text="{Binding OriginY}"/>
        </Grid>

        <TextBlock Grid.Row="8" Grid.Column="0" Margin="3">Textures</TextBlock>
        <ListBox Grid.Row="8" Grid.Column="1" Margin="3" ItemsSource="{Binding Textures}" Name="TextureList" IsSynchronizedWithCurrentItem="True">
            <ListBox.ItemContainerStyle>
                <Style TargetType="ListBoxItem">
                    <Setter Property="HorizontalContentAlignment" Value="Stretch" />
                </Style>
            </ListBox.ItemContainerStyle>
            <ListBox.ItemTemplate>
                <DataTemplate>
                    <local:UndertaleObjectReference Margin="20,0,0,0" ObjectReference="{Binding TextureId}" ObjectType="{x:Type undertale:UndertaleTexturePage}"/>
                </DataTemplate>
            </ListBox.ItemTemplate>
        </ListBox>

        <Viewbox Grid.Row="9" Grid.Column="1" Stretch="Uniform" StretchDirection="DownOnly">
            <Border>
                <Border.Background>
                    <DrawingBrush Stretch="None" TileMode="Tile" Viewport="0,0,20,20" ViewportUnits="Absolute">
                        <DrawingBrush.Drawing>
                            <DrawingGroup>
                                <GeometryDrawing Geometry="M0,0 L20,0 20,20, 0,20Z" Brush="White"/>
                                <GeometryDrawing Geometry="M0,10 L20,10 20,20, 10,20 10,0 0,0Z" Brush="LightGray"/>
                            </DrawingGroup>
                        </DrawingBrush.Drawing>
                    </DrawingBrush>
                </Border.Background>
                <local:UndertaleTexturePageDisplayCropped DataContext="{Binding SelectedItem.TextureId, ElementName=TextureList}"/>
            </Border>
        </Viewbox>

        <!-- TODO: Editor for the masks -->
        <TextBlock Grid.Row="10" Grid.Column="0" Margin="3">Collision masks</TextBlock>
        <ItemsControl Grid.Row="11" Grid.Column="1" Margin="3" ItemsSource="{Binding CollisionMaskData}">
            <ItemsControl.ItemTemplate>
                <DataTemplate>
                    <Viewbox Stretch="None">
                        <Border BorderThickness="2" BorderBrush="Gray">
                            <Image Stretch="None">
                                <Image.Source>
                                    <MultiBinding>
                                        <MultiBinding.Converter>
                                            <local:MaskImageConverer/>
                                        </MultiBinding.Converter>
                                        <Binding RelativeSource="{RelativeSource AncestorType=ItemsControl}" Path="DataContext.Width"/>
                                        <Binding RelativeSource="{RelativeSource AncestorType=ItemsControl}" Path="DataContext.Height"/>
                                        <Binding Path="."/>
                                    </MultiBinding>
                                </Image.Source>
                            </Image>
                        </Border>
                    </Viewbox>
                </DataTemplate>
            </ItemsControl.ItemTemplate>
        </ItemsControl>
    </Grid>
</UserControl>
